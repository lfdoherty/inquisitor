Implements finite-state-machine style tests with a simple precondition syntax.
